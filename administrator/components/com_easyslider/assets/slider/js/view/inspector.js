void function(exports,$,_,Backbone){var colorPickerOptions={doRender:true,buildCallback:function($elm){var colorInstance=this.color,colorPicker=this;$elm.prepend('<div class="cp-panel">'+'<div class="input-wrapper">R <input type="text" class="cp-r" /></div>'+'<div class="input-wrapper">G <input type="text" class="cp-g" /></div>'+'<div class="input-wrapper">B <input type="text" class="cp-b" /></div>'+'<div class="input-wrapper">H <input type="text" class="cp-h" /></div>'+'<div class="input-wrapper">S <input type="text" class="cp-s" /></div>'+'<div class="input-wrapper">B <input type="text" class="cp-v" /></div>'+'<input type="text" class="cp-HEX" />'+"</div>").on("change","input",function(e){var value=this.value,className=this.className,type=className.split("-")[1],color={};color[type]=value;colorInstance.setColor(type==="HEX"?value:color,type==="HEX"?"HEX":/(?:r|g|b)/.test(type)?"rgb":"hsv");colorPicker.render()});$(".cp-color-picker").addClass("color-picker-hidden")},cssAddon:".cp-panel{ width:63px;}"+".cp-color-picker{box-sizing:border-box; width:230px;}"+".cp-color-picker .cp-panel {line-height: 21px; float:right;"+"padding:0 1px 0 8px; margin-top:-1px; overflow:visible}"+".cp-xy-slider:active {cursor:none;}"+".cp-panel, .cp-panel input {color:#bbb; font-family:monospace,"+'"Courier New",Courier,mono; font-size:12px; font-weight:bold;}'+".cp-panel input {width:40px; height:15px;"+"text-align:right; line-height:14px; background:transparent;"+"border:1px solid; border-color:#222 #666 #666 #222;}"+".cp-panel hr {margin:0 -2px 2px; height:1px; border:0;"+"background:#666; border-top:1px solid #222;}"+".cp-panel .cp-HEX {width:56px; position:absolute; margin:1px -3px 0 -2px;}"+".cp-alpha {width:155px;}",renderCallback:function($elm,toggled){var action;if(toggled===false&&!$(".cp-color-picker").hasClass("color-picker-hidden"))action="close";if(toggled===true&&$(".cp-color-picker").hasClass("color-picker-hidden"))action="open";if(action=="open"&&!$elm.val())$elm.val("#000000");var colors=this.color.colors.RND,modes={r:colors.rgb.r,g:colors.rgb.g,b:colors.rgb.b,h:colors.hsv.h,s:colors.hsv.s,v:colors.hsv.v,HEX:this.color.colors.HEX};$("input",".cp-panel").each(function(){this.value=modes[this.className.substr(3)]});if(action=="close"){$elm.trigger("change:color");$(".cp-color-picker").addClass("color-picker-hidden")}if(action=="open"){$(".cp-color-picker").removeClass("color-picker-hidden")}}};exports.JSNES_InspectorView=Backbone.View.extend({events:{"keydown input,select,button,a,textarea":"inputKeydownHandler","change [data-bind]:not(.input-color)":"changeInputDataBinding","change:color [data-bind]":"changeInputDataBinding",'click #item-effect .inner-container ul.nav-pills[role="tablist"] li':"showAnimationView"},showAnimationView:function(){$(".jsn-es-animation-selector").trigger("show")},constructor:function JSNES_InspectorView(){Backbone.View.apply(this,arguments);this.targets=[];this.debounceUpdateData=_.debounce(this.updateData)},ready:function(){this.ensureInputInitialized();if(this.model)this.inspect(this.model);this.debounceUpdateData()},inspect:function(model){if(this.targets.indexOf(model)==-1)this.targets.push(model);return model},release:function(model){log("Inspector :: release");if(model){_(this.targets).each(function(foundModel,index){if(foundModel&&foundModel.cid==model.cid){this.stopListening(foundModel);this.targets.splice(index,1)}},this)}else{while(this.targets.length){var model=this.targets.pop();this.stopListening(model)}}return this},getValuesOf:function(key){var values=[];_.each(this.targets,function(model){var value;if(key.match(/style\.(.*)/)&&key!=="style.visibility")value=model.getStyle(key.replace(/style\.(.*)/,"$1"));else value=model.get(key);if(values.indexOf(value)==-1)values.push(value)});return values},getValueOf:function(key){var values=this.getValuesOf(key);if(values.length==1)return values[0];else return"-"},updateData:function(){if(this._frozen)return;var targets=this.targets;if(!targets.length)return this;log("Inspector :: update data ::",_(this.targets).pluck("cid"),this.__proto__.constructor.name);var selector=this.$('ul[role="tablist"] li.active a').attr("href");var inspector=this;this.$("*[data-bind]").each(function(i,el){var $el=$(el);var key=$el.attr("data-bind");var value=inspector.getValueOf(key);var multipleValues=inspector.getValuesOf(key).length>1?true:false;var timeType=$el.attr("data-type");var unit=$el.attr("data-unit");if($el.is(":not(.input-number)")){value||(value="")}if($el.is(".input-color")){!multipleValues||(value="")}if(timeType=="time"&&!multipleValues){value=(value/1e3).toFixed(1)}if($el.is(".input-number")){if(value&&!multipleValues){var numberValue=_.parseNumberUnit(value);var decimal=$el.attr("decimal");var unit=numberValue.unit||unit;var value=numberValue.value;decimal&&(value=numberValue.value.toFixed(parseFloat(decimal)));unit&&(value+=""+unit)}}if($el.attr("type")=="toggle"){value.toString()=="true"||$el.attr("value-on")==value.toString()?$el.attr("data-on",true):$el.attr("data-on",false)}else if($el.is(".btn-group")){!multipleValues||(value=" ");$el.find(".btn.active").removeClass("active");$el.find('.btn[data-value="'+value+'"]').addClass("active")}else if($el.is(".btn")){!multipleValues||(value="");multipleValues?$el.removeClass("active"):value.toString()=="true"||$el.attr("data-on")==value.toString()?$el.addClass("active"):$el.removeClass("active")}else{$el.val(value);if($el.is(".input-color")){$el.css({backgroundColor:value})}if($el.is(".fonts-select")){$el.trigger("change",{silent:true})}}});return this},changeInputDataBinding:function(e,data){data||(data={});if(this._frozen)return;if(!this.targets.length)return;if(data.silent)return;var $el=$(e.currentTarget);var key=$el.attr("data-bind");var unit=$el.attr("data-unit");var type=$el.attr("data-type");log("Inspector :: input changed ::",key,this.targets);if($el.attr("type")=="toggle"){var value=$el.attr("data-on")=="true"?$el.attr("value-on")||true:$el.attr("value-off")||false}else if($el.is(".input-number")){var value=$el.val().replace(/\s+/,"");if(value){var numberValue=_.parseNumberUnit(value);var decimal=$el.attr("decimal");var unit=numberValue.unit||unit;value=numberValue.value;decimal&&(value=numberValue.value.toFixed(parseFloat(decimal)));unit&&(value+=""+unit)}}else if($el.is(".btn-group")){var value=$el.find(".btn.active").attr("data-value")||""}else if($el.is(".btn")){var value=$el.hasClass("active")?$el.attr("data-on")||true:$el.attr("data-off")||false}else var value=$el.val();if(type=="time")value=parseFloat(value)*1e3;if(typeof value==="string")value=value.trim();if(key.match(/style\.(.*)/)&&key!=="style.visibility")_(this.targets).invoke("setStyle",key.replace(/style\.(.*)/,"$1"),value);else _(this.targets).invoke("set",key,value);log("Inspector :: set",key,value,typeof value)},ensureInputInitialized:function(){this.$(".input-number:not(.input-number-initialized)").addClass("input-number-initialized").JSNES_NumberInput();this.$(".input-image:not(.input-image-initialized)").addClass("input-image-initialized").JSNES_ImageInput();this.$(".input-color:not(.input-color-initialized)").addClass("input-color-initialized").JSNES_ColorInput();this.$(".input-color").colorPicker(colorPickerOptions)},removeColor:function(e){var $input=$(e.currentTarget).parents(".form-group").find("input.input-color");$input.val("");if($input.attr("data-bind"))_(this.targets).invoke("set",$input.attr("data-bind"),"");e.preventDefault()},numberInputKeyDownHandler:function(e){var $el=$(e.currentTarget);var numberValue=_.parseNumberUnit($el.val());var value=numberValue.value||0;var unit=numberValue.unit||$el.attr("data-unit")||"";var step=parseFloat($el.attr("step")||1);var min=parseFloat($el.attr("min"));var max=parseFloat($el.attr("max"));var decimal=$el.attr("decimal");var caretPosition=$el.getCaretPosition();!e.shiftKey||(step*=10);switch(e.keyCode){case 38:var newValue=!_.isNaN(max)&&value+step>max?max:value+step;break;case 40:var newValue=!_.isNaN(min)&&value-step<min?min:value-step;break}if(typeof newValue=="number"){e.preventDefault();decimal&&(newValue=newValue.toFixed(parseFloat(decimal)));unit&&(newValue+=""+unit);$el.val(newValue).trigger("change").setCaretPosition(caretPosition)}},inputKeydownHandler:function(e){e.stopPropagation()}})}(this,JSNES_jQuery,JSNES_Underscore,JSNES_Backbone);