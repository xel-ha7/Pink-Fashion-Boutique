define(['react','react-dom','jsn/libs/common/event','jsn/libs/common/text'],function(React,ReactDOM,Event,Text){var JSNModal=React.createClass({displayName:'JSNModal',getDefaultProps:function(){return{id:'',show:false,type:'',title:'',width:'720px',height:'',content:'',buttons:[],preserve:false,className:null,centralize:true};},getInitialState:function(){return this.props;},render:function(){var content;switch(this.state.type){case 'iframe':this.state.content.ref='iframe';if(this.state.content.src){this.state.content.key=this.state.content.src.replace(/[^a-zA-Z0-9\-_]+/g,'');}content=React.createElement('iframe',this.state.content);break;default:content=this.state.content;break;}var footer,buttons=[];if(this.state.buttons instanceof Array){this.state.buttons.map(button=>{var button_text='';if(button.text){button_text=button.text;delete button.text;}if(button['class']){button.className=button['class'];delete button['class'];}if(!button.href&&!button.type){button.type='button';}if(button.href){buttons.push(React.createElement('a',button,button_text));}else{buttons.push(React.createElement('button',button,button_text));}button.text=button_text;});}return React.createElement('div',{id:this.state.id?this.state.id:Text.toId('modal',true),ref:'mountedDOMNode',className:'modal-container hide fade '+(this.state.className?' '+this.state.className:'')},React.createElement('div',{className:'modal-dialog'},React.createElement('div',{className:'modal-content'},this.state.title?React.createElement('div',{className:'modal-header'},React.createElement('button',{type:'button',onClick:this.close,className:'close'},React.createElement('span',null,'\xD7')),React.createElement('h4',{className:'modal-title'},this.state.title)):null,React.createElement('div',{className:'modal-body'},content),buttons.length?React.createElement('div',{className:'modal-footer'},buttons):null)));},componentDidMount:function(){if(this.state.show){this.open();}},componentDidUpdate:function(){if(this.state.show){this.open();}},open:function(){this.closeTimeout&&clearTimeout(this.closeTimeout);if(this.refs.mountedDOMNode.classList.contains('hide')){this.refs.mountedDOMNode.classList.remove('hide');}this.refs.mountedDOMNode.style.display='block';var modal_dialog=this.refs.mountedDOMNode.querySelector('.modal-dialog');if(this.state.width){var width=parseInt(this.state.width);if(this.state.width.substr(-1)=='%'){width=window.innerWidth/100 * width;}if(window.innerWidth<width){width=window.innerWidth;}modal_dialog.style.left=(window.innerWidth-width)/2+'px';modal_dialog.style.width=width+'px';}var modal_body=this.refs.mountedDOMNode.querySelector('.modal-body'),container_css=window.getComputedStyle(modal_dialog),content_rect=this.refs.mountedDOMNode.querySelector('.modal-content').getBoundingClientRect(),header=this.refs.mountedDOMNode.querySelector('.modal-header'),header_rect=header?header.getBoundingClientRect():{top:content_rect.top,height:0},footer=this.refs.mountedDOMNode.querySelector('.modal-footer'),footer_rect=footer?footer.getBoundingClientRect():{height:0},height;modal_body.style.overflowX='hidden';modal_body.style.overflowY='auto';if(this.state.height){var height=parseInt(this.state.height);if(this.state.height.substr(-1)=='%'){height=window.innerHeight/100 * height;}if(window.innerHeight<height){height=window.innerHeight;}height-=header_rect.height+footer_rect.height;modal_body.style.height=height+'px';modal_body.style.maxHeight='initial';}else{height=window.innerHeight-parseInt(container_css.getPropertyValue('margin-top'))-parseInt(container_css.getPropertyValue('margin-bottom'))-(header_rect.top-parseInt(container_css.getPropertyValue('margin-top')))* 2-header_rect.height-footer_rect.height;modal_body.style.height='initial';modal_body.style.maxHeight=height+'px';}if(this.state.type=='iframe'&&['auto','100%'].indexOf(this.state.content.height)>-1){var modal_body_css=window.getComputedStyle(modal_body),iframe_css=window.getComputedStyle(this.refs.iframe);this.refs.iframe.style.height=height-parseInt(modal_body_css.getPropertyValue('padding-top'))-parseInt(modal_body_css.getPropertyValue('padding-bottom'))-parseInt(iframe_css.getPropertyValue('border-top-width'))-parseInt(iframe_css.getPropertyValue('border-bottom-width'))+'px';modal_body.style.overflowY='hidden';}if(this.state.centralize){modal_dialog.style.marginTop=Math.floor((window.innerHeight-modal_dialog.getBoundingClientRect().height)/2)+'px';}this.refs.mountedDOMNode.classList.add('in');if(!this.refs.mountedDOMNode._added_show_to_resize){Event.add(window,'resize',this.open);this.refs.mountedDOMNode._added_show_to_resize=true;}Event.trigger(this,'ModalOpened');},close:function(event){event&&event.preventDefault();if(event!==false&&typeof this.state.close=='function'){this.state.close();}this.refs.mountedDOMNode.classList.remove('in');this.closeTimeout=setTimeout(function(){this.refs.mountedDOMNode.style.display='none';}.bind(this),250);if(this.refs.mountedDOMNode._added_show_to_resize){delete this.refs.mountedDOMNode._added_show_to_resize;Event.remove(window,'resize',this.open);}Event.trigger(this,'ModalClosed');}});JSNModal.container=null;JSNModal.modals=[];JSNModal.get=function(state,reuse){var modal,n=JSNModal.modals.length;if(n){var reuse=reuse===undefined?true:reuse;for(var i=0;i<n;i++){if(JSNModal.modals[i].props.preserve||JSNModal.modals[i].state.preserve){continue;}else if(reuse||JSNModal.modals[i].refs.mountedDOMNode.style.display=='none'){modal=JSNModal.modals[i];break;}}}if(!modal){var element=document.createElement('div');if(!JSNModal.container){JSNModal.container=document.createElement('div');JSNModal.container.id=Text.toId('container',true);JSNModal.container.className='jsn-bootstrap3';if(JSNModal.containerClass){JSNModal.container.className=JSNModal.containerClass;}document.body.appendChild(JSNModal.container);}JSNModal.container.appendChild(element);modal=ReactDOM.render(React.createElement(JSNModal),element);JSNModal.modals.push(modal);}if(!state){state={};}if(state.show===undefined){state.show=true;}if(state['class']){state.className=state['class'];delete state['class'];}['width','height','buttons','className','centralize'].map(p=>{if(state[p]===undefined){state[p]=JSNModal.defaultProps[p];}});modal.setState(state);return modal;};JSNModal.hide=function(event){for(var i=0,n=JSNModal.modals.length;i<n;i++){if(JSNModal.modals[i].refs.mountedDOMNode.style.display!='none'){JSNModal.modals[i].close(event);}}};JSNModal.update=function(){for(var i=0,n=JSNModal.modals.length;i<n;i++){if(JSNModal.modals[i].refs.mountedDOMNode.style.display!='none'){JSNModal.modals[i].forceUpdate();}}};return JSNModal;});